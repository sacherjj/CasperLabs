# CasperLabs Python Client API library and command line tool

## Typical usage of the API

```python
from casper_client import casper_client as client

# By default the client will communicate with node running on
# localhost and listening on port 40401, this can be changed:
client.host = 'node1'
client.port = 40402

response = client.deploy(from_=b"00000000000000000000",
                         gas_limit=100000000,
                         gas_price=1,
                         session="session.wasm",
                         payment="payment.wasm")
if response.success:
    print ('Deployed OK!')

```

User can instantiate several instances of `CasperClient` and configure them to
communicate with nodes running on different machines:

```python
from casper_client import CasperClient

client1 = CasperClient('node1host', 40401)
client2 = CasperClient('node2host', 40401)
```

## Command Line Interface

Apart from being a library `casper_client.py` provides also a command line interface.

When executed with no parameters it will print to the console short usage summary, 
running it with `--help` will print more details. 

```bash
$ ./casper_client.py --help
usage: casper_client.py [--help] [-h HOST] [-p PORT]
                        {deploy,propose,show-block,show-blocks,vdag,query-state,show-main-chain,find-block-with-deploy}
                        ...

positional arguments:
  {deploy,propose,show-block,show-blocks,vdag,query-state,show-main-chain,find-block-with-deploy}
                        Choose a request
    deploy              Deploy a smart contract source file to Casper on an
                        existing running node. The deploy will be packaged and
                        sent as a block to the network depending on the
                        configuration of the Casper instance
    propose             Force a node to propose a block based on its
                        accumulated deploys.
    show-block          View properties of a block known by Casper on an
                        existing running node. Output includes: parent hashes,
                        storage contents of the tuplespace.
    show-blocks         View list of blocks in the current Casper view on an
                        existing running node.
    vdag                DAG in DOT format
    query-state         Query a value in the global state.
    show-main-chain     Show main chain
    find-block-with-deploy
                        Find block with deploy.

optional arguments:
  --help                show this help message and exit
  -h HOST, --host HOST  Hostname or IP of node on which gRPC service is
                        running.
  -p PORT, --port PORT  Port used for external gRPC API.

```

To get detailed description of syntax of a chosen request (command), run it with `--help`:

```bash
$ ./casper_client.py deploy --help
usage: casper_client.py deploy [-h] -f FROM -g GAS_LIMIT --gas-price GAS_PRICE
                               [-n NONCE] -p PAYMENT -s SESSION

optional arguments:
  -h, --help            show this help message and exit
  -f FROM, --from FROM  Purse address that will be used to pay for the
                        deployment.
  -g GAS_LIMIT, --gas-limit GAS_LIMIT
                        The amount of gas to use for the transaction (unused
                        gas is refunded). Must be positive integer.
  --gas-price GAS_PRICE
                        The price of gas for this transaction in units
                        dust/gas. Must be positive integer.
  -n NONCE, --nonce NONCE
                        This allows you to overwrite your own pending
                        transactions that use the same nonce.
  -p PAYMENT, --payment PAYMENT
                        Path to the file with payment code
  -s SESSION, --session SESSION
                        Path to the file with session code

```

```bash
$ ./casper_client.py deploy --from 00000000000000000000 --gas-limit 100000000 --gas-price 1 --session session.wasm --payment payment.wasm 
Success!
```

See also [Usage of the CasperLabs system](https://github.com/CasperLabs/CasperLabs/blob/dev/USAGE.md).


## Development

Modules `CasperMessage_pb2.py`, `CasperMessage_pb2_grpc.py`, `scalapb/scalapb_pb2_grpc.py` and `scalapb/scalapb_pb2.py`
are generated from gRPC service definitions with `protoc`. They can be regenerated by running `./run_codegen.py`.
